<html>
<header>
<title>Rice vs Roti</title>
</header>
<head>
<meta charset="utf-8">
<script src="https://d3js.org/d3.v5.min.js"></script>
<style>
.roti {
  color: #FF9933;
}

.rice {
  color: #138808;
}

div.tooltip {	
    position: absolute;			
    text-align: center;			
    width: 140px;					
    height: 50px;					
    padding: 2px;				
    font: 12px sans-serif;		
    background: lightblue;	
    border: 0px;			
    pointer-events: none;			
}

</style>
</head>
<body>
  <div id = "postContents"; style="text-align:center;"> 
  <h1 align="center"><span class="roti">Team Roti</span> <span class="hr4">vs</span> <span class="rice">Team Rice</span></h1>
  <h2 align="center">(Per capita consumption differential by state)</h2>
  
  
  <script>
    let margin = {top: 10, right: 20, bottom: 10, left: 450};
    let width = 1200 - margin.left - margin.right;
    let height = 700 - margin.top - margin.bottom;
    
    let svg = d3.select("body").append("svg")
      .attr("width", width + margin.left + margin.right)
      .attr("height", height + margin.top + margin.bottom)
      .append("g")
        .attr("transform",
          "translate(" + margin.left + "," + margin.top + ")");
          
    svg.append("rect")
      .attr("width",width)
      .attr("height",height)
      .style("fill","green")
      .style("opacity", 0); //Background best practice
        
    let div = d3.select("body").append("div")	
      .attr("class", "tooltip")				
      .style("opacity", 0);
    
    Promise.all([
      d3.json("india-states.json"),
      d3.csv("consumption.csv")
    ]).then(function(data){
      let geoJsonData = data[0];
      let languageData = data[1];
      let projection = d3.geoMercator();
      projection.fitHeight(height-100,geoJsonData);
      let pathGenerator = d3.geoPath().projection(projection);
      
    //   <!-- Append map of India -->
      let india = svg.append('g');     
      india.selectAll('path')
        .data(geoJsonData.features)
        .enter()
        .append('path')
          .attr('d', pathGenerator)
          .style("fill", function(d) {
            if(d.state == "Kerala") {
              return "red";
            }
            return "back";
          })
          .style("stroke", "black")
          .on("mouseover", function(d) {
            div.style("opacity", .9);		
            div.html(d.state + "</br>" 
            + d.rice_total + "kg Rice </br>" 
            + d.wheat_total + "kg Wheat </br>")
            
            .style("left", (d3.event.pageX) + "px")		
            .style("top", (d3.event.pageY - 28) + "px");
          })					
          .on("mouseout", function(d) {		
            div.style("opacity", 0);	
          });
      
      console.log("Bout to go off");
      
      let colorScale = d3.scaleLinear()
        .domain([-18, 28])
        .range(['orange', 'green']);
        
      let orangeScale = d3.scaleLinear()
        .domain([50, 100])
        .range(['#FFFFFF','#FF9933']);
        
      let greenScale = d3.scaleLinear()
        .domain([50, 100])
        .range(['#FFFFFF','#138808']);
        
      
      india.selectAll('path')
        .data(languageData)
        .style("fill", function(d) {
          let rice = d.rice_percent;
          let wheat = d.wheat_percent;
          let team = d.team;
          if(team == "roti") {
            return orangeScale(d.wheat_percent);
          }
          return greenScale(d.rice_percent);
        });
              
      
      console.log("Went off");
                                  
    }) //End of Promise
  </script>
  
  </div>
  <h3 align="center">Source: http://mospi.nic.in/sites/default/files/publication_reports/Report_no558_rou68_30june14.pdf</h3>
</body>
</html>