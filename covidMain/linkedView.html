<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
        <meta name="description" content="" />
        <meta name="author" content="" />
        <title style="font-size: 100px;">COVID 19 In India - Age and Gender Distributions</title>
        <!-- Favicon-->
        <link rel="icon" type="image/x-icon" href="assets/favicon.ico" />
        <!-- Core theme CSS (includes Bootstrap)-->
        <link href="css/styles.css" rel="stylesheet" />
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
        <script src="https://d3js.org/d3.v6.min.js"></script>
        <script src="https://d3js.org/d3-path.v2.min.js"></script>
        <script src="https://d3js.org/d3-shape.v2.min.js"></script>
        <script src="https://d3js.org/topojson.v1.min.js"></script>
        <script src="https://d3js.org/d3-array.v2.min.js"></script>
        <script src="https://d3js.org/d3-geo.v2.min.js"></script>
        <script src="https://d3js.org/d3-geo-projection.v3.min.js"></script>
        <script src="https://unpkg.com/react/umd/react.development.js"></script>
        <script src="https://unpkg.com/react-dom/umd/react-dom.development.js"></script>
        <script src="https://unpkg.com/babel-standalone/babel.js"></script>
        
        <div id="tooltip"></div><!-- div to hold tooltip. -->
        
         <!-- creates india State. -->
    </head>

    <style>
        .state{
            fill: none;
            stroke: #a9a9a9;
            stroke-width: 1;
        }
        .state:hover{
            fill-opacity:0.5;
        }
        #tooltip {   
            position: absolute;           
            text-align: center;
            padding: 20px;             
            margin: 10px;
            font: 12px sans-serif;        
            background: lightsteelblue;   
            border: 1px;      
            border-radius: 2px;           
            pointer-events: none;         
        }
        #tooltip h4{
            margin:0;
            font-size:14px;
        }
        #tooltip{
            background:rgba(0,0,0,0.9);
            border:1px solid grey;
            border-radius:5px;
            font-size:12px;
            width:auto;
            padding:4px;
            color:white;
            opacity:0;
        }
        #tooltip table{
            table-layout:fixed;
        }
        #tooltip tr td{
            padding:0;
            margin:0;
        }
        #tooltip tr td:nth-child(1){
            width:50px;
        }
        #tooltip tr td:nth-child(2){
            text-align:center;
        }
    </style>
    <body>
        <!-- Responsive navbar-->
        <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
            <div class="container">
                <a class="navbar-brand" href="#!">COVID 19 in India</a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button>
                <div class="collapse navbar-collapse" id="navbarSupportedContent">
                    <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
                        <li class="nav-item"><a class="nav-link active" aria-current="page" href="#!">Home</a></li>
                        <li class="nav-item"><a class="nav-link" href="linkedView.html">Distribution Data</a></li>
                        <li class="nav-item"><a class="nav-link" href="rawData.html">Raw Data</a></li>
                    </ul>
                </div>
            </div>
        </nav>
        <!-- Header - set the background image for the header in the line below-->
        <header class="py-5 bg-image-full" style="background-image: url('assets/pic2.jpeg')">
            <div class="text-center my-5">
                
                <h1  style="font-size: 100px; color: black;">COVID 19 in India</h1>
                <p style="font-size: 70px; color: white;">Age and Gender Distribtions</p>
            </div>
        </header>
        <!-- Content section-->
        <section class="py-5">
            <div class="container my-5">
                <div class="row justify-content-center">
                    <div class="col-lg-6">
                        <h2>Full Width Backgrounds</h2>
                        <p class="lead">A single, lightweight helper class allows you to add engaging, full width background images to sections of your page.</p>
                        <p class="mb-0">The universe is almost 14 billion years old, and, wow! Life had no problem starting here on Earth! I think it would be inexcusably egocentric of us to suggest that we're alone in the universe.</p>
                    </div>
                </div>
            </div>
        </section>
        <!-- Image element - set the background image for the header in the line below-->
        <div class="py-5 bg-image-full" style="background-image: url('assets/pic3.jpeg')">
            <!-- Put anything you want here! The spacer below with inline CSS is just for demo purposes!-->
            <div style="height: 20rem"></div>
        </div>
        <!-- Content section-->
        <section class="py-5">
            <div class="container my-5">
                <div class="row justify-content-center">
                    <div class="col-lg-6">
                        <h2>Engaging Background Images</h2>
                        <p class="lead">The background images used in this template are sourced from Unsplash and are open source and free to use.</p>
                        <p class="mb-0">I can't tell you how many people say they were turned off from science because of a science teacher that completely sucked out all the inspiration and enthusiasm they had for the course.</p>
                    </div>
                </div>
            </div>
        </section>

    <div id="root"></div>
    <script type="text/babel">
        
    const completeUrl = "data/completeFiltered.csv";
    const csvUrl = 'https://gist.githubusercontent.com/hogwild/3b9aa737bde61dcb4dfa60cde8046e04/raw/citibike2020.csv';
    const mapUrl = "states.json";
    
    function useCompleteData(csvPath){
        const [dataAll, setData] = React.useState(null);
        React.useEffect(() => {   
            d3.csv(csvPath).then(data => {
                data.forEach(d => {
                    d.death = +d.death;//derive a new attribute: popularity
                    d.Cured = +d.Cured;
                    d.New_cases = +d.New_cases;
                    d.Latitude = +d.Latitude;
                    d.Longitude = +d.Longitude;
                    d.Total_Confirmed_cases = +d.Total_Confirmed_cases;
                });
                setData(data);
            });
        }, []);
        return dataAll;
    }
   
    function useMap(jsonPath) {
        const [data, setData] = React.useState(null);
        React.useEffect(() => {
            d3.json(jsonPath).then(geoJsonData => {
                setData(geoJsonData);
            })
        }, []);
        return data;
    }
    function Tooltip2(props) {
        const {d, stationYearData, left, top, height, width} = props;

        if (!d) {
            return <g></g>;
        } else {
            return <g transform={`translate(${left}, ${top})`}>
                    <text style={{ textAnchor:'start', fontSize:'15px'}}  transform={`translate(${0}, ${-5})rotate(0)`}>{d.station} </text>
                    <SymmetricAreaChart offsetX={0} offsetY={0} height={height/2}
                        width={width} data={stationYearData}/>
                </g>
        };  
    }
    function Tooltip(props) {


        const mystyle = {
            
            // text-align: center,
            width: "60px",
            height: "35px",
            fontFamily: "Arial", 
            backgroundColor: "green",
            // border: "0px",
        //                    border-radius: 8px,
        //                  pointer-events: none,
        };

    const {event, selectedPoint, data} = props;

  

    console.log(data, 318);

    console.log(event, 320);
    const currentData = data.filter( d => { 
        return d.Name === selectedPoint; 
    });
    console.log(currentData, 324);
    console.log(currentData.length, 325);
    let stationData = currentData[0];
    const name = "Hello";
    if (selectedPoint === null){
        return <div> </div> 
    }else{
        
        return <div  style={{opacity: "0.9", position: "fixed" , background: "rgb(60, 185, 119)" , height: "100px", width: "120px", top:event.pageY+2.5, left:event.pageX}}>
        
        <h1 style={{fontSize: "12px", fontStyle: "Arial"}}>{stationData.station}</h1>
        <h1 style={{fontSize: "12px", fontStyle: "Arial"}}>Trip Durations</h1>

        <ul style={{fontSize: "12px", fontStyle: "Arial"}}>
            <li> End in: {stationData.start} </li>
            <li> Start from: {stationData.end}</li>
        </ul>
        </div>
        
    }
    }
    function SymbolMap(props) {
        const {x, y, map, data, height, width, forecast, selectedName, setSelectedName} = props;
        const projection = d3.geoMercator()
            .scale(50)
            .fitSize([width, height], map);
        console.log(forecast, 121);

        const path = d3.geoPath(projection);
        
        const radius = d3.scaleLinear().range([2, 11])
            .domain([d3.min(data, d=>d.Cured), d3.max(data, d=>d.Cured)]);
        const radius2 = d3.scaleLinear().range([0.04, 0.3])
            .domain([d3.min(data, d=>d.Death), d3.max(data, d=>d.Death)]);
        const radius3 = d3.scaleLinear().range([2, 11])
            .domain([d3.min(data, d=>d.Total_Confirmed_cases), d3.max(data, d=>d.Total_Confirmed_cases)]);
        const mouseOver = d =>{
            setSelectedName(d.Name);
        };
        const mouseOut = () => {
            setSelectedName(null);
        };

        //console.log(data, 62);

        // Size of the station == popularity

        
        //console.log(map, 53);
        // 1. min 2, max 20
        // 2. On hover turn blue

        console.log(data, 138);
        if(forecast === null || forecast === "CURED"){
            return <g transform={`translate(${x}, ${y})`}>
                <path  d={path()} />
                {map.features.map(feature => {
                    //console.log(feature.properties.name, 72);       
                    // get the color of circles in red
                    
                    //console.log(stations, 79);         
                    return <path key={feature.properties.name + "boundary"} className={"boundary"}
                        d={path(feature)}/>                    
                    })}
                    
                    
                    {data.map(d => {
                                //console.log(xScale(d.tripdurationS, 95));
                        const [x, y] = projection([d.Longitude, d.Latitude]);
                        return <circle key = {d.Longitude + d.Latitude}
                        cx={x} cy={y}  r={radius(d.Cured)} fill = {"green"} stroke = {`purple`} opacity={1}  /> 
                    


                    })}
                        
                </g>
            }
        else if(forecast === "DEAD"){
            return <g transform={`translate(${x}, ${y})`}>
                <path  d={path()} />
                {map.features.map(feature => {
                    //console.log(feature.properties.name, 72);       
                    // get the color of circles in red
                    
                    //console.log(stations, 79);         
                    return <path key={feature.properties.name + "boundary"} className={"boundary"}
                        d={path(feature)}/>                    
                    })}
                    
                    
                    {data.map(d => {
                                //console.log(xScale(d.tripdurationS, 95));
                        const [x, y] = projection([d.Longitude, d.Latitude]);
                        return <circle key = {d.Longitude + d.Latitude}
                        cx={x} cy={y} r={radius2(d.Death)} fill = {"white"} stroke = {`black`} opacity={1}  /> 
                    


                    })}
                        
                </g>
            }
        else if(forecast === "CONFIRMED"){
            return <g transform={`translate(${x}, ${y})`}>
                <path  d={path()} />
                {map.features.map(feature => {
                    //console.log(feature.properties.name, 72);       
                    // get the color of circles in red
                    
                    //console.log(stations, 79);         
                    return <path key={feature.properties.name + "boundary"} className={"boundary"}
                        d={path(feature)}/>                    
                    })}
                    
                    
                    {data.map(d => {
                                //console.log(xScale(d.tripdurationS, 95));
                        const [x, y] = projection([d.Longitude, d.Latitude]);
                        return <circle key = {d.Longitude + d.Latitude}
                        cx={x} cy={y} r={radius3(d.Total_Confirmed_cases)} fill = {"red"} stroke = {`black`} opacity={1}  /> 
                    


                    })}
                        
                </g>
        }
      

    }
    
    const IndiaCompleteData = () => {
        const [month, setMonth] = React.useState('4');

        const [forecast, setForecast] = React.useState(null);
        const [selectedName, setSelectedName] = React.useState(null);
        const completeData = useCompleteData(completeUrl);
        console.log(completeData, 408);
        // console.log(dataAll, 410);
        const MONTH = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
        const map = useMap(mapUrl);
        if (!map || !completeData) {
                return <pre>Loading...</pre>;
            };
        
        const WIDTH = 1200;
        const HEIGHT = 1000;
        const margin = { top: 20, right: 40, bottom: 160, left: 40, gap:40 };
        const innerWidth = WIDTH - margin.left - margin.right - margin.gap;
        const innerHeight = HEIGHT - margin.top - margin.bottom - margin.gap;
        // const data = completeData.filter( d => {
        //    // return d.month === MONTH[month];
        // });
        // Note: stationYearData is the data of the year of a seleted station. 
        const stationYearData = completeData.filter( d=> {
            return d.Name == setSelectedName;
        }); 
        const changeHandler = (event) => {
            setForecast(event.target.value);
        }
        console.log(forecast, 194);
        const selectedPoint = completeData.filter(d => d.Name===selectedName)[0];
        // console.log(stationYearData.map( d => d.popularity));  
        return <div>
          
            <div  style={{position: "absolute", textAlign: "left", width: "240px",left:"840px", top:"1270px"}}>
                <form action="/action_page.php"> 
                    <input  type='radio'  name="fav_language" value= "DEAD" id="html" 
                        onChange={() => changeHandler(event)}/>
                    <label for="DEAD">DEAD</label>
                    <br></br>
                    <input  type='radio' name="fav_language"  value= "CURED"  id="CURED"
                        onChange={() => changeHandler(event)}/>
                    <label for="CURED">CURED</label>
                    <br></br>
                    <input  type='radio' name="fav_language" value= "CONFIRMED"  id="CONFIRMED"
                        onChange={() => changeHandler(event)}/>
                    <label for="CONFIRMED">CONFIRMED</label>
                    <br></br>
                </form>
            </div>
            <svg width={WIDTH} height={HEIGHT}>
                    <g>                      
                        <SymbolMap setSelectedName={setSelectedName} selectedName = {selectedName} x={margin.left+550} y={margin.top} height={innerHeight+margin.gap} 
                        width={innerWidth/2} data={completeData} map={map} forecast = {forecast}/>
                    </g>
            </svg>
          
            <div style={{position: "absolute", textAlign: "left", width: "240px",left:"220px", top:"1240px"}}>
                <h3>India Map 1</h3>
                <p>National Map to see the cured, dead and the confirmed cases</p>
            </div>
            
        </div>
    }
    ReactDOM.render( <IndiaCompleteData />, document.getElementById('root'));
    </script>








        <!-- Footer-->
        <footer class="py-5 bg-dark">
            <div class="container"><p class="m-0 text-center text-white">Copyright &copy; YashBit</p></div>
        </footer>
        <!-- Bootstrap core JS-->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
        <!-- Core theme JS-->
        <script src="js/scripts.js"></script>
    </body>
</html>
